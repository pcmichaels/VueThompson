<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Running Race</title>
    </head>
    <body>        
        <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

        <div id="app">

            <player
                v-bind:location="location">
            </player>

            <seconds-remaining 
                v-bind:seconds="secondsRemaining">
            </seconds-remaining>            
        </div>

        <script>

            Vue.component('seconds-remaining', {
                props: ['seconds'],
                template: `
                    <p>Seconds remaining: {{ seconds }}</p>
                `
            });
            Vue.component('player', {
                props: ['location'],
                template: `
                    <div v-bind:style="location"></div>
                `
            });

            new Vue({
                el: '#app',

                data: {                    
                    playerX: 100,
                    playerY: 100,
                    speed: 0,
                    toggleSpeed: 1,                    
                    startTime: 0,
                    timeNow: 0
                },

                created() {
                    window.addEventListener('keydown', this.onKeyDown);
                },

                computed: {                    
                    location: function() {
                        return 'width:10px; height:10px; left:' + this.playerX + 'px; top:' + this.playerY + 'px; border:1px solid #000; position: absolute;';
                    },

                    secondsRemaining: function() {
                        const diff = (this.startTime - this.timeNow) / 1000;
                        return Math.round(diff);
                    }
                },

                methods: {
                    init() {
                        setInterval(this.update, 10);
                        this.startTime = new Date();
                        this.startTime.setSeconds(this.startTime.getSeconds() + 20);
                    },

                    onKeyDown(e) {                        
                        switch (e.which) {
                            case 37: // Left
                                this.playerRun(1); 
                                break;
                            case 39: // Right
                                this.playerRun(2); 
                                break;
                            default:
                                break;
                        }
                    },
                    
                    playerRun(toggle) {                        
                        if (this.toggleSpeed !== toggle) {                           
                            this.speed += 0.12;
                            this.toggleSpeed = toggle;
                        }
                    },                  

                    update() {
                        this.playerX += this.speed;

                        if (this.speed > 0) {
                            this.speed -= 0.01;
                        } else {
                            this.speed = 0;
                        }

                        this.timeNow = new Date().getTime();
                    }
                },

                mounted() {
                    this.init();
                }
            });            
        </script>        
    </body>
</html>